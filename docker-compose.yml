version: '3.8'

services:
  # バックエンド (FastAPI + MAVLink)
  backend:
    build: ./backend
    container_name: rover-backend
    restart: always
    ports:
      - "8001:8000"       # ホスト8001 -> コンテナ8000 (WebODM回避)
      - "14552:14552/udp" # MAVLink受信用 (変更なし)
    environment:
      - CONNECTION_STRING=udp:0.0.0.0:14552
    volumes:
      # ミッション計画データの永続化
      - ./missions:/app/missions

  # フロントエンド (React)
  frontend:
    build: ./frontend
    container_name: rover-frontend
    restart: always
    ports:
      - "3000:5173"       # ホスト3000 -> コンテナ3000
    # 本番運用でも簡易的にdevサーバーで動かします（ビルドの手間を省略）
    command: npm run dev -- --host
